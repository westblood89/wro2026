<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WRO 2026 Türkiye - Puan ve İhtimaller Paneli</title>
    <style>
        :root {
            --primary-color: #009688; /* Küçük Yıldızlar */
            --secondary-color: #FF5722; /* Yıldızlar */
            --header-bg: #333;
            --border-color: #ddd;
            --checked-bg: #d1e7dd; 
            --checked-border: #a3cfbb;
        }

        body { 
            font-family: 'Segoe UI', Tahoma, sans-serif; 
            margin: 0; padding: 10px; 
            background-color: #f0f2f5; color: #333; 
        }
        .container { 
            max-width: 1000px; margin: 0 auto; 
            background: white; padding: 20px; 
            border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); 
        }

        /* Sekmeler */
        .tabs { display: flex; flex-wrap: wrap; margin-bottom: 25px; border-bottom: 2px solid #e0e0e0; gap: 5px; }
        .tab-btn { 
            flex: 1; padding: 14px; border: none; background: #f5f5f5; 
            cursor: pointer; font-weight: 600; color: #666; border-radius: 8px 8px 0 0; 
            min-width: 160px; transition: all 0.2s ease; font-size: 1rem;
        }
        .tab-btn.active { background: var(--header-bg); color: white; transform: translateY(-2px); }

        /* Tablo Stilleri */
        table { width: 100%; border-collapse: collapse; margin-bottom: 30px; }
        th, td { border: 1px solid var(--border-color); padding: 12px; text-align: left; }
        th { background-color: var(--header-bg); color: white; font-size: 0.95rem; }
        .section-header { background-color: #f1f1f1; font-weight: 700; color: #444; }

        input[type="number"] { 
            width: 60px; text-align: center; padding: 6px; 
            border: 2px solid #ccc; border-radius: 6px; font-size: 1rem; font-weight: bold;
        }
        input[type="checkbox"] { transform: scale(1.5); cursor: pointer; }

        /* Renkler */
        .c-red { color: #d32f2f; font-weight: bold; }
        .c-green { color: #2e7d32; font-weight: bold; }
        .c-blue { color: #1565c0; font-weight: bold; }
        .c-yellow { color: #f9a825; font-weight: bold; text-shadow: 0px 0px 1px #999; }
        .c-black { color: #000; font-weight: bold; }
        .c-white { color: #7f8c8d; font-weight: bold; }

        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* İhtimaller Listesi */
        .checklist-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 12px; }
        .checklist-item { 
            display: flex; align-items: center; background: #fff; 
            border: 1px solid #ddd; padding: 12px; border-radius: 8px; 
            cursor: pointer; transition: all 0.2s ease; 
        }
        .checklist-item:hover { transform: translateY(-2px); box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .checklist-item.checked { 
            background-color: var(--checked-bg); 
            border-color: var(--checked-border);
            color: #111;
        }
        .checklist-item input { margin-right: 15px; pointer-events: none; }

        .group-box { border: 1px solid #e0e0e0; border-radius: 10px; padding: 15px; margin-bottom: 25px; background: #fafafa; }
        .group-title { margin-top: 0; color: #444; border-bottom: 2px solid #ddd; padding-bottom: 8px; margin-bottom: 15px; }

        .action-bar { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .btn { border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: bold; color: white; }
        .btn-clear { background: #ff9800; }
        .btn-save { background: #2196F3; }
        .btn-load { background: #673AB7; }

        .total-sticky { 
            position: sticky; bottom: 10px; background: var(--header-bg); color: white; 
            padding: 15px 25px; border-radius: 10px; display: flex; justify-content: space-between; 
            align-items: center; z-index: 100; box-shadow: 0 5px 15px rgba(0,0,0,0.2); 
        }
        .reset-btn { background: #d32f2f; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <div class="tabs">
        <button class="tab-btn active" onclick="openTab('score-ls', this)">Küçük Yıldızlar Puan</button>
        <button class="tab-btn" onclick="openTab('prob-ls', this)">Küçük Yıldızlar İhtimaller</button>
        <button class="tab-btn" onclick="openTab('score-s', this)">Yıldızlar Puan</button>
        <button class="tab-btn" onclick="openTab('prob-s', this)">Yıldızlar İhtimaller</button>
    </div>

    <div id="content-score-ls" class="tab-content active">
        <h2 style="color:var(--primary-color)">Küçük Yıldızlar Puan Hesaplama</h2>
        <form id="form-ls">
            <table>
                <thead><tr><th style="width:55%">Görevler</th><th>Puan</th><th>Adet</th><th>Toplam</th></tr></thead>
                <tbody>
                    <tr class="section-header"><td colspan="4">1. Amfiyi hoparlöre bağlama (Maksimum 2 Kablo)</td></tr>
                    <tr><td>Kablo gri alanın tamamen içinde, düz ve dik</td><td>15</td><td><input type="number" id="ls_kb_f" min="0" max="2" value="0" onchange="validateGroup('ls_kb_f', ['ls_kb_f','ls_kb_p'], 2); calcLS();"></td><td id="res_ls_kb_f">0</td></tr>
                    <tr><td>Kablo gri alanın kısmen içinde veya düz/dik değil</td><td>5</td><td><input type="number" id="ls_kb_p" min="0" max="2" value="0" onchange="validateGroup('ls_kb_p', ['ls_kb_f','ls_kb_p'], 2); calcLS();"></td><td id="res_ls_kb_p">0</td></tr>
                    
                    <tr class="section-header"><td colspan="4">2. Gösteri hazırlığı (Maks 1 Mikrofon / 3 Enstrüman)</td></tr>
                    <tr><td>Mikrofon tamamen içinde, düz ve dik</td><td>20</td><td><input type="number" id="ls_mk_f" min="0" max="1" value="0" onchange="validateGroup('ls_mk_f', ['ls_mk_f','ls_mk_p'], 1); calcLS();"></td><td id="res_ls_mk_f">0</td></tr>
                    <tr><td>Mikrofon kısmen içinde veya düz/dik değil</td><td>10</td><td><input type="number" id="ls_mk_p" min="0" max="1" value="0" onchange="validateGroup('ls_mk_p', ['ls_mk_f','ls_mk_p'], 1); calcLS();"></td><td id="res_ls_mk_p">0</td></tr>
                    <tr><td>Enstrüman tamamen sahne arkası alanının içinde</td><td>15</td><td><input type="number" id="ls_ens" min="0" max="3" value="0" onchange="calcLS()"></td><td id="res_ls_ens">0</td></tr>

                    <tr class="section-header"><td colspan="4">3. Şarkıyı çal (Maksimum 6 Nota)</td></tr>
                    <tr><td>Nota hedef alanının tamamen içinde, düz ve dik</td><td>20</td><td><input type="number" id="ls_nt_f" min="0" max="6" value="0" onchange="validateGroup('ls_nt_f', ['ls_nt_f','ls_nt_p'], 6); calcLS();"></td><td id="res_ls_nt_f">0</td></tr>
                    <tr><td>Nota hedef alanının kısmen içinde veya düz/dik değil</td><td>10</td><td><input type="number" id="ls_nt_p" min="0" max="6" value="0" onchange="validateGroup('ls_nt_p', ['ls_nt_f','ls_nt_p'], 6); calcLS();"></td><td id="res_ls_nt_p">0</td></tr>

                    <tr class="section-header"><td colspan="4">4. Bonus Puan</td></tr>
                    <tr><td>Sol anahtarı zarar görmemiş/hareket ettirilmemiş</td><td>10</td><td><input type="checkbox" id="ls_bon_sol" onchange="calcLS()"></td><td id="res_ls_bon_sol">0</td></tr>
                    <tr><td>Hoparlör zarar görmemiş/hareket ettirilmemiş (Maks 2)</td><td>10</td><td><input type="number" id="ls_bon_hop" min="0" max="2" value="0" onchange="calcLS()"></td><td id="res_ls_bon_hop">0</td></tr>
                    <tr><td>Amfi zarar görmemiş/hareket ettirilmemiş</td><td>10</td><td><input type="checkbox" id="ls_bon_amf" onchange="calcLS()"></td><td id="res_ls_bon_amf">0</td></tr>
                </tbody>
            </table>
        </form>
        <div class="total-sticky">
            <button class="reset-btn" onclick="resetScore('ls')">Sıfırla</button>
            <div style="font-size:1.4rem; font-weight:bold">Toplam Puan: <span id="ls_total">0</span> / 255</div>
        </div>
    </div>

    <div id="content-prob-ls" class="tab-content">
        <h2>Küçük Yıldızlar İhtimaller Listesi</h2>
        <div class="action-bar">
            <button class="btn btn-clear" onclick="clearProb('ls')">Listeyi Temizle</button>
            <button class="btn btn-save" onclick="saveJSON('ls')">Kaydet (.json)</button>
            <button class="btn btn-load" onclick="document.getElementById('file-ls').click()">Yükle</button>
            <input type="file" id="file-ls" style="display:none" onchange="loadJSON(event, 'ls')">
        </div>
        <div id="ls-group-container"></div>
    </div>

    <div id="content-score-s" class="tab-content">
        <h2 style="color:var(--secondary-color)">Yıldızlar Puan Hesaplama</h2>
        <form id="form-s">
            <table>
                <thead><tr><th style="width:55%">Görevler</th><th>Puan</th><th>Adet</th><th>Toplam</th></tr></thead>
                <tbody>
                    <tr class="section-header"><td colspan="4">1. Ziyaretçilere Rehberlik Et (Maksimum 4 Ziyaretçi)</td></tr>
                    <tr><td>Ziyaretçi tamamen kendi renk alanının içinde ve dik</td><td>10</td><td><input type="number" id="s_ziy_f" min="0" max="4" value="0" onchange="validateGroup('s_ziy_f', ['s_ziy_f','s_ziy_p'], 4); calcS();"></td><td id="res_s_ziy_f">0</td></tr>
                    <tr><td>Ziyaretçi kısmen kendi renk alanında veya dik değil</td><td>5</td><td><input type="number" id="s_ziy_p" min="0" max="4" value="0" onchange="validateGroup('s_ziy_p', ['s_ziy_f','s_ziy_p'], 4); calcS();"></td><td id="res_s_ziy_p">0</td></tr>

                    <tr class="section-header"><td colspan="4">2. Kuleleri Yeniden İnşa Et (Maks 2 Kırmızı / 2 Sarı)</td></tr>
                    <tr><td>Kırmızı kule tamamen hedefte ve dik</td><td>15</td><td><input type="number" id="s_kr_f" min="0" max="2" value="0" onchange="validateGroup('s_kr_f', ['s_kr_f','s_kr_p'], 2); calcS();"></td><td id="res_s_kr_f">0</td></tr>
                    <tr><td>Kırmızı kule kısmen hedefte veya dik değil</td><td>10</td><td><input type="number" id="s_kr_p" min="0" max="2" value="0" onchange="validateGroup('s_kr_p', ['s_kr_f','s_kr_p'], 2); calcS();"></td><td id="res_s_kr_p">0</td></tr>
                    <tr><td>Sarı kule üstü doğru + tabanı tamamen hedefte</td><td>25</td><td><input type="number" id="s_sa_f" min="0" max="2" value="0" onchange="validateGroup('s_sa_f', ['s_sa_f','s_sa_p'], 2); calcS();"></td><td id="res_s_sa_f">0</td></tr>
                    <tr><td>Sarı kule üstü doğru + tabanı kısmen hedefte</td><td>15</td><td><input type="number" id="s_sa_p" min="0" max="2" value="0" onchange="validateGroup('s_sa_p', ['s_sa_f','s_sa_p'], 2); calcS();"></td><td id="res_s_sa_p">0</td></tr>

                    <tr class="section-header"><td colspan="4">3. Tarihi Eserleri Müzeye Getir (Maksimum 4 Eser)</td></tr>
                    <tr><td>Tarihi eser tamamen müzede ve dik</td><td>15</td><td><input type="number" id="s_es_f" min="0" max="4" value="0" onchange="validateGroup('s_es_f', ['s_es_f','s_es_p'], 4); calcS();"></td><td id="res_s_es_f">0</td></tr>
                    <tr><td>Tarihi eser kısmen müzede veya dik değil</td><td>5</td><td><input type="number" id="s_es_p" min="0" max="4" value="0" onchange="validateGroup('s_es_p', ['s_es_f','s_es_p'], 4); calcS();"></td><td id="res_s_es_p">0</td></tr>

                    <tr class="section-header"><td colspan="4">4. Taş Döşemeyi Kirden Temizle (Maks 10 Kir)</td></tr>
                    <tr><td>Kir parçacıkları taş döşeme alanına değmiyor</td><td>2</td><td><input type="number" id="s_kir" min="0" max="10" value="0" onchange="calcS()"></td><td id="res_s_kir">0</td></tr>

                    <tr class="section-header"><td colspan="4">5. Bonus Puanlar</td></tr>
                    <tr><td>Bariyerler zarar görmemiş/hareket etmemiş (x2)</td><td>10</td><td><input type="number" id="s_bon_bar" min="0" max="2" value="0" onchange="calcS()"></td><td id="res_s_bon_bar">0</td></tr>
                    <tr><td>Papağan zarar görmemiş/hareket etmemiş</td><td>10</td><td><input type="checkbox" id="s_bon_pap" onchange="calcS()"></td><td id="res_s_bon_pap">0</td></tr>
                </tbody>
            </table>
        </form>
        <div class="total-sticky">
            <button class="reset-btn" onclick="resetScore('s')">Sıfırla</button>
            <div style="font-size:1.4rem; font-weight:bold">Toplam Puan: <span id="s_total">0</span> / 230</div>
        </div>
    </div>

    <div id="content-prob-s" class="tab-content">
        <h2>Yıldızlar İhtimaller Listesi</h2>
        <div class="action-bar">
            <button class="btn btn-clear" onclick="clearProb('s')">Listeyi Temizle</button>
            <button class="btn btn-save" onclick="saveJSON('s')">Kaydet (.json)</button>
            <button class="btn btn-load" onclick="document.getElementById('file-s').click()">Yükle</button>
            <input type="file" id="file-s" style="display:none" onchange="loadJSON(event, 's')">
        </div>
        <div id="s-matrix-container"></div>
    </div>
</div>

<script>
    // --- AKILLI LİMİT FONKSİYONU ---
    // Bu fonksiyon, bir gruptaki girişlerin toplamının maksimum sınırı aşmasını engeller.
    function validateGroup(changedId, groupIds, maxLimit) {
        let currentInput = document.getElementById(changedId);
        let currentVal = parseInt(currentInput.value) || 0;
        
        let otherTotal = 0;
        groupIds.forEach(id => {
            if (id !== changedId) {
                otherTotal += parseInt(document.getElementById(id).value) || 0;
            }
        });

        if (currentVal + otherTotal > maxLimit) {
            // Eğer toplam sınırı aşarsa, mevcut girişi kalan miktara sabitler
            currentInput.value = maxLimit - otherTotal;
        }
    }

    const colors = { 'Sarı': 'c-yellow', 'Lacivert': 'c-blue', 'Siyah': 'c-black', 'Beyaz': 'c-white', 'Kırmızı': 'c-red', 'Yeşil': 'c-green' };
    function cS(txt) { return `<span class="${colors[txt] || ''}">${txt}</span>`; }

    function openTab(id, btn) {
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        document.getElementById('content-' + id).classList.add('active');
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
    }

    function calcLS() {
        let total = 0;
        const p = { ls_kb_f: 15, ls_kb_p: 5, ls_mk_f: 20, ls_mk_p: 10, ls_ens: 15, ls_nt_f: 20, ls_nt_p: 10, ls_bon_hop: 10 };
        for(let k in p) {
            let val = parseInt(document.getElementById(k).value) || 0;
            document.getElementById('res_'+k).innerText = val * p[k];
            total += val * p[k];
        }
        let sol = document.getElementById('ls_bon_sol').checked ? 10 : 0;
        let amf = document.getElementById('ls_bon_amf').checked ? 10 : 0;
        document.getElementById('res_ls_bon_sol').innerText = sol;
        document.getElementById('res_ls_bon_amf').innerText = amf;
        document.getElementById('ls_total').innerText = total + sol + amf;
    }

    function calcS() {
        let total = 0;
        const p = { s_ziy_f: 10, s_ziy_p: 5, s_kr_f: 15, s_kr_p: 10, s_sa_f: 25, s_sa_p: 15, s_es_f: 15, s_es_p: 5, s_kir: 2, s_bon_bar: 10 };
        for(let k in p) {
            let val = parseInt(document.getElementById(k).value) || 0;
            document.getElementById('res_'+k).innerText = val * p[k];
            total += val * p[k];
        }
        let pap = document.getElementById('s_bon_pap').checked ? 10 : 0;
        document.getElementById('res_s_bon_pap').innerText = pap;
        document.getElementById('s_total').innerText = total + pap;
    }

    function resetScore(cat) {
        if(!confirm('Puanları sıfırlamak istiyor musunuz?')) return;
        document.getElementById('form-'+cat).reset();
        cat === 'ls' ? calcLS() : calcS();
    }

    function initLSProbs() {
        const cont = document.getElementById('ls-group-container');
        const vars = ['Sarı', 'Lacivert', 'Siyah', 'Beyaz'];
        const fixed = [cS('Kırmızı'), cS('Yeşil')];
        const getPerms = arr => {
            if (arr.length <= 2) return arr.length === 2 ? [arr, [arr[1], arr[0]]] : [arr];
            return arr.reduce((acc, item, i) => acc.concat(getPerms([...arr.slice(0, i), ...arr.slice(i + 1)]).map(val => [item, ...val])), []);
        };
        const perms = getPerms(vars);
        const groups = {};
        perms.forEach(p => { if(!groups[p[0]]) groups[p[0]] = []; groups[p[0]].push(p); });
        cont.innerHTML = "";
        for(let head in groups) {
            let box = `<div class="group-box"><h3 class="group-title">${cS(head)} ile Başlayanlar</h3><div class="checklist-grid">`;
            groups[head].forEach((p, idx) => {
                const uid = `ls_v3_${head}_${idx}`;
                const chk = localStorage.getItem(uid) === 'true' ? 'checked' : '';
                box += `<div class="checklist-item ${chk}" onclick="toggleProb('${uid}', this)">
                    <input type="checkbox" ${chk?'checked':''}>
                    <div>${cS(p[0])} - ${cS(p[1])} - ${fixed[0]} - ${fixed[1]} - ${cS(p[2])} - ${cS(p[3])}</div>
                </div>`;
            });
            cont.innerHTML += box + `</div></div>`;
        }
    }

    function initSProbs() {
        const cont = document.getElementById('s-matrix-container');
        const list = ['Kırmızı', 'Sarı', 'Yeşil', 'Siyah', 'Beyaz', 'Lacivert'];
        cont.innerHTML = "";
        list.forEach(f => {
            let box = `<div class="group-box"><h3 class="group-title">İlk Renk: ${cS(f)}</h3><div class="checklist-grid">`;
            list.forEach(s => {
                if(f===s) return;
                const uid = `s_v3_${f}_${s}`;
                const chk = localStorage.getItem(uid) === 'true' ? 'checked' : '';
                box += `<div class="checklist-item ${chk}" onclick="toggleProb('${uid}', this)">
                    <input type="checkbox" ${chk?'checked':''}>
                    <div>Sonraki: ${cS(s)}</div>
                </div>`;
            });
            cont.innerHTML += box + `</div></div>`;
        });
    }

    function toggleProb(id, el) {
        const cb = el.querySelector('input');
        cb.checked = !cb.checked;
        el.classList.toggle('checked', cb.checked);
        localStorage.setItem(id, cb.checked);
    }

    function clearProb(cat) {
        if(!confirm('Tüm işaretlemeleri temizlemek istediğinize emin misiniz?')) return;
        const prefix = cat === 'ls' ? 'ls_v3_' : 's_v3_';
        Object.keys(localStorage).forEach(k => { if(k.startsWith(prefix)) localStorage.removeItem(k); });
        cat === 'ls' ? initLSProbs() : initSProbs();
    }

    function saveJSON(cat) {
        const data = {};
        const prefix = cat === 'ls' ? 'ls_v3_' : 's_v3_';
        Object.keys(localStorage).forEach(k => { if(k.startsWith(prefix)) data[k] = localStorage.getItem(k); });
        const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = `wro_2026_${cat}_takip.json`;
        a.click();
    }

    function loadJSON(ev, cat) {
        const file = ev.target.files[0];
        if(!file) return;
        const reader = new FileReader();
        reader.onload = e => {
            try {
                const data = JSON.parse(e.target.result);
                Object.keys(data).forEach(k => localStorage.setItem(k, data[k]));
                location.reload();
            } catch(e) { alert('Hatalı dosya!'); }
        };
        reader.readAsText(file);
    }

    window.onload = () => { initLSProbs(); initSProbs(); calcLS(); calcS(); };
</script>

</body>
</html>
